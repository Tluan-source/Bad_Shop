<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head th:replace="~{fragments/head :: head}">
<title>Shipper Dashboard - Badminton Marketplace</title>
</head>
<body>
	<div th:replace="~{fragments/header-shipper :: header-shipper}"></div>

	<div class="container-fluid mt-4">
		<div class="alert alert-success alert-dismissible fade show"
			role="alert">
			<i class="fas fa-check-circle"></i> Ch√†o m·ª´ng <strong
				sec:authentication="name">Shipper</strong> ƒë·∫øn v·ªõi trang qu·∫£n l√Ω
			giao h√†ng!
			<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
		</div>

		<h2 class="mb-4">Dashboard - T·ªïng quan giao h√†ng</h2>

		<!-- üîç Form t√¨m ki·∫øm - ƒê∆°n gi·∫£n v√† g·ªçn g√†ng -->
		<form class="row g-3 mb-4" method="get" th:action="@{/shipper/dashboard}">
			<!-- Hidden input ƒë·ªÉ gi·ªØ tr·∫°ng th√°i hi·ªán t·∫°i khi t√¨m ki·∫øm -->
			<input type="hidden" name="status" th:value="${status}">
			
			<div class="col-12 col-md-5">
				<div class="input-group">
					<span class="input-group-text bg-primary text-white">
						<i class="fas fa-search"></i>
					</span>
					<input type="text" name="keyword" class="form-control form-control-lg"
						placeholder="T√¨m theo m√£ ƒë∆°n, t√™n kh√°ch h√†ng ho·∫∑c ƒë·ªãa ch·ªâ..." th:value="${keyword}">
				</div>
			</div>
			<div class="col-6 col-md-2">
				<input type="date" name="fromDate" class="form-control form-control-lg"
					placeholder="T·ª´ ng√†y" th:value="${fromDate}">
			</div>
			<div class="col-6 col-md-2">
				<input type="date" name="toDate" class="form-control form-control-lg"
					placeholder="ƒê·∫øn ng√†y" th:value="${toDate}">
			</div>
			<div class="col-12 col-md-3">
				<button type="submit" class="btn btn-primary btn-lg w-100">
					<i class="fas fa-filter me-2"></i>L·ªçc k·∫øt qu·∫£
				</button>
			</div>
		</form>

		<!-- üì¶ T·ªïng quan - Responsive Cards -->
		<div class="row mt-3">
			<div class="col-6 col-md-3 mb-3">
				<div class="card text-white bg-warning shadow h-100">
					<div class="card-body d-flex justify-content-between align-items-center">
						<div>
							<h6 class="mb-1">Ch·ªù nh·∫≠n</h6>
							<h3 class="mb-0" th:text="${totalPending}">0</h3>
						</div>
						<i class="fas fa-box fa-2x d-none d-sm-block"></i>
					</div>
				</div>
			</div>
			<div class="col-6 col-md-3 mb-3">
				<div class="card text-white bg-info shadow h-100">
					<div class="card-body d-flex justify-content-between align-items-center">
						<div>
							<h6 class="mb-1">ƒêang giao</h6>
							<h3 class="mb-0" th:text="${totalDelivering}">0</h3>
						</div>
						<i class="fas fa-truck fa-2x d-none d-sm-block"></i>
					</div>
				</div>
			</div>
			<div class="col-6 col-md-3 mb-3">
				<div class="card text-white bg-success shadow h-100">
					<div class="card-body d-flex justify-content-between align-items-center">
						<div>
							<h6 class="mb-1">ƒê√£ giao</h6>
							<h3 class="mb-0" th:text="${totalDelivered}">0</h3>
						</div>
						<i class="fas fa-check-circle fa-2x d-none d-sm-block"></i>
					</div>
				</div>
			</div>
			<div class="col-6 col-md-3 mb-3">
				<div class="card text-white bg-danger shadow h-100">
					<div class="card-body d-flex justify-content-between align-items-center">
						<div>
							<h6 class="mb-1">Th·∫•t b·∫°i</h6>
							<h3 class="mb-0" th:text="${totalFailed}">0</h3>
						</div>
						<i class="fas fa-times-circle fa-2x d-none d-sm-block"></i>
					</div>
				</div>
			</div>
		</div>

		<!-- ‚ú® Tab Navigation cho c√°c tr·∫°ng th√°i - Ph√≥ng to v√† d·ªÖ click -->
		<div class="card shadow mt-4">
			<!-- Tab Headers - L·ªõn h∆°n v√† r√µ r√†ng h∆°n -->
			<div class="card-header bg-light p-0">
				<ul class="nav nav-tabs card-header-tabs fs-5" id="shipmentTabs" role="tablist">
					<li class="nav-item flex-fill" role="presentation">
						<a class="nav-link text-center py-3" 
							th:href="@{/shipper/dashboard(status='PENDING', keyword=${keyword}, fromDate=${fromDate}, toDate=${toDate})}"
							th:classappend="${status == 'PENDING'} ? 'active' : ''">
							<i class="fas fa-box fa-lg me-2" th:classappend="${status == 'PENDING'} ? 'text-white' : 'text-warning'"></i> 
							<span class="fw-bold">Ch·ªù nh·∫≠n</span>
						</a>
					</li>
					<li class="nav-item flex-fill" role="presentation">
						<a class="nav-link text-center py-3"
							th:href="@{/shipper/dashboard(status='DELIVERING', keyword=${keyword}, fromDate=${fromDate}, toDate=${toDate})}"
							th:classappend="${status == 'DELIVERING'} ? 'active' : ''">
							<i class="fas fa-truck fa-lg me-2" th:classappend="${status == 'DELIVERING'} ? 'text-white' : 'text-info'"></i> 
							<span class="fw-bold">ƒêang giao</span>
						</a>
					</li>
					<li class="nav-item flex-fill" role="presentation">
						<a class="nav-link text-center py-3"
							th:href="@{/shipper/dashboard(status='DELIVERED', keyword=${keyword}, fromDate=${fromDate}, toDate=${toDate})}"
							th:classappend="${status == 'DELIVERED'} ? 'active' : ''">
							<i class="fas fa-check-circle fa-lg me-2" th:classappend="${status == 'DELIVERED'} ? 'text-white' : 'text-success'"></i> 
							<span class="fw-bold">ƒê√£ giao</span>
						</a>
					</li>
					<li class="nav-item flex-fill" role="presentation">
						<a class="nav-link text-center py-3"
							th:href="@{/shipper/dashboard(status='FAILED', keyword=${keyword}, fromDate=${fromDate}, toDate=${toDate})}"
							th:classappend="${status == 'FAILED'} ? 'active' : ''">
							<i class="fas fa-times-circle fa-lg me-2" th:classappend="${status == 'FAILED'} ? 'text-white' : 'text-danger'"></i> 
							<span class="fw-bold">Th·∫•t b·∫°i</span>
						</a>
					</li>
				</ul>
			</div>

			<!-- Tab Content -->
			<div class="tab-content" id="shipmentTabsContent">
				<!-- üü° Tab Ch·ªù nh·∫≠n -->
				<div class="tab-pane fade show active" id="pending" role="tabpanel" 
					th:if="${status == 'PENDING'}">
					<div class="card-body p-0">
						<div class="table-responsive">
							<table class="table table-hover align-middle mb-0">
								<thead class="table-light">
									<tr>
										<th class="ps-3">M√£ ƒë∆°n</th>
										<th>Kh√°ch h√†ng</th>
										<th class="d-none d-md-table-cell">ƒê·ªãa ch·ªâ</th>
										<th>COD</th>
										<th class="d-none d-lg-table-cell">Ng√†y t·∫°o</th>
										<th class="text-end pe-3">Thao t√°c</th>
									</tr>
								</thead>
								<tbody>
									<tr th:each="order : ${pendingOrders.content}">
										<td class="ps-3" th:text="${order.id}">#ORD</td>
										<td th:text="${order.user.fullName}">T√™n</td>
										<td class="d-none d-md-table-cell" th:text="${order.address}">ƒê·ªãa ch·ªâ</td>
										<td th:text="${#numbers.formatDecimal(order.amountFromUser,0,'POINT',0,'COMMA')} + ' ‚Ç´'"></td>
										<td class="d-none d-lg-table-cell" th:text="${#temporals.format(order.createdAt,'dd/MM/yyyy')}">Ng√†y</td>
										<td class="text-end pe-3">
											<a th:href="@{'/shipper/order/' + ${order.id}}"
												class="btn btn-sm btn-outline-secondary">
												<i class="fas fa-eye"></i>
											</a>
											<form th:action="@{'/shipper/accept/' + ${order.id}}"
												method="post" class="d-inline">
												<button type="submit" class="btn btn-sm btn-warning">
													<i class="fas fa-handshake"></i> <span class="d-none d-sm-inline">Nh·∫≠n</span>
												</button>
											</form>
										</td>
									</tr>
									<tr th:if="${#lists.isEmpty(pendingOrders.content)}">
										<td colspan="6" class="text-center text-muted py-4">
											<i class="fas fa-inbox fa-2x mb-2"></i><br>
											Kh√¥ng c√≥ ƒë∆°n h√†ng ch·ªù nh·∫≠n
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>

				<!-- üîµ Tab ƒêang giao -->
				<div class="tab-pane fade show active" id="delivering" role="tabpanel"
					th:if="${status == 'DELIVERING'}">
					<div class="card-body p-0">
						<div class="table-responsive">
							<table class="table table-hover align-middle mb-0">
								<thead class="table-light">
									<tr>
										<th class="ps-3">M√£ ƒë∆°n</th>
										<th>Kh√°ch h√†ng</th>
										<th class="d-none d-md-table-cell">ƒê·ªãa ch·ªâ</th>
										<th>COD</th>
										<th class="d-none d-lg-table-cell">Th·ªùi gian nh·∫≠n</th>
										<th class="text-end pe-3">Thao t√°c</th>
									</tr>
								</thead>
								<tbody>
									<tr th:each="ship : ${delivering.content}">
										<td class="ps-3" th:text="${ship.order.id}">#ORD</td>
										<td th:text="${ship.order.user.fullName}">T√™n</td>
										<td class="d-none d-md-table-cell" th:text="${ship.order.address}">ƒê·ªãa ch·ªâ</td>
										<td th:text="${#numbers.formatDecimal(ship.order.amountFromUser,0,'POINT',0,'COMMA')} + ' ‚Ç´'"></td>
										<td class="d-none d-lg-table-cell" th:text="${#temporals.format(ship.acceptedAt,'HH:mm dd/MM')}">Gi·ªù</td>
										<td class="text-end pe-3">
											<a th:href="@{'/shipper/shipment/' + ${ship.id}}"
												class="btn btn-sm btn-outline-secondary">
												<i class="fas fa-eye"></i>
											</a>
											<form th:action="@{'/shipper/delivered/' + ${ship.id}}"
												method="post" class="d-inline">
												<button type="submit" class="btn btn-sm btn-success" title="ƒê√£ giao">
													<i class="fas fa-check"></i>
												</button>
											</form>
											<button type="button" class="btn btn-sm btn-danger" 
												data-bs-toggle="modal" 
												th:attr="data-bs-target='#failModal' + ${ship.id}"
												title="Giao th·∫•t b·∫°i">
												<i class="fas fa-times"></i>
											</button>
											
											<!-- Modal cho ghi ch√∫ th·∫•t b·∫°i -->
											<div class="modal fade" th:id="'failModal' + ${ship.id}" tabindex="-1">
												<div class="modal-dialog modal-dialog-centered">
													<div class="modal-content">
														<div class="modal-header">
															<h5 class="modal-title">Ghi ch√∫ giao h√†ng th·∫•t b·∫°i</h5>
															<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
														</div>
														<form th:action="@{'/shipper/failed/' + ${ship.id}}" method="post">
															<div class="modal-body">
																<textarea name="note" class="form-control" rows="3" 
																	placeholder="Nh·∫≠p l√Ω do giao h√†ng th·∫•t b·∫°i..." required></textarea>
															</div>
															<div class="modal-footer">
																<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
																<button type="submit" class="btn btn-danger">
																	<i class="fas fa-times"></i> X√°c nh·∫≠n th·∫•t b·∫°i
																</button>
															</div>
														</form>
													</div>
												</div>
											</div>
										</td>
									</tr>
									<tr th:if="${#lists.isEmpty(delivering.content)}">
										<td colspan="6" class="text-center text-muted py-4">
											<i class="fas fa-inbox fa-2x mb-2"></i><br>
											Kh√¥ng c√≥ ƒë∆°n h√†ng ƒëang giao
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>

				<!-- üü¢ Tab ƒê√£ giao -->
				<div class="tab-pane fade show active" id="delivered" role="tabpanel"
					th:if="${status == 'DELIVERED'}">
					<div class="card-body p-0">
						<div class="table-responsive">
							<table class="table table-hover align-middle mb-0">
								<thead class="table-light">
									<tr>
										<th class="ps-3">M√£ ƒë∆°n</th>
										<th>Kh√°ch h√†ng</th>
										<th class="d-none d-md-table-cell">ƒê·ªãa ch·ªâ</th>
										<th>COD</th>
										<th class="d-none d-lg-table-cell">Ng√†y giao</th>
										<th class="text-end pe-3">Xem</th>
									</tr>
								</thead>
								<tbody>
									<tr th:each="ship : ${delivered.content}">
										<td class="ps-3" th:text="${ship.order.id}">#ORD</td>
										<td th:text="${ship.order.user.fullName}">T√™n</td>
										<td class="d-none d-md-table-cell" th:text="${ship.order.address}">ƒê·ªãa ch·ªâ</td>
										<td th:text="${#numbers.formatDecimal(ship.order.amountFromUser,0,'POINT',0,'COMMA')} + ' ‚Ç´'"></td>
										<td class="d-none d-lg-table-cell" th:text="${#temporals.format(ship.deliveredAt,'dd/MM/yyyy HH:mm')}">Ng√†y</td>
										<td class="text-end pe-3">
											<a th:href="@{'/shipper/shipment/' + ${ship.id}}"
												class="btn btn-sm btn-outline-secondary">
												<i class="fas fa-eye"></i> <span class="d-none d-sm-inline">Chi ti·∫øt</span>
											</a>
										</td>
									</tr>
									<tr th:if="${#lists.isEmpty(delivered.content)}">
										<td colspan="6" class="text-center text-muted py-4">
											<i class="fas fa-inbox fa-2x mb-2"></i><br>
											Kh√¥ng c√≥ ƒë∆°n h√†ng ƒë√£ giao
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>

				<!-- üî¥ Tab Th·∫•t b·∫°i -->
				<div class="tab-pane fade show active" id="failed" role="tabpanel"
					th:if="${status == 'FAILED'}">
					<div class="card-body p-0">
						<div class="table-responsive">
							<table class="table table-hover align-middle mb-0">
								<thead class="table-light">
									<tr>
										<th class="ps-3">M√£ ƒë∆°n</th>
										<th>Kh√°ch h√†ng</th>
										<th class="d-none d-md-table-cell">ƒê·ªãa ch·ªâ</th>
										<th>COD</th>
										<th class="d-none d-lg-table-cell">Ng√†y c·∫≠p nh·∫≠t</th>
										<th class="d-none d-xl-table-cell">Ghi ch√∫</th>
										<th class="text-end pe-3">Xem</th>
									</tr>
								</thead>
								<tbody>
									<tr th:each="ship : ${failed.content}">
										<td class="ps-3" th:text="${ship.order.id}">#ORD</td>
										<td th:text="${ship.order.user.fullName}">T√™n</td>
										<td class="d-none d-md-table-cell" th:text="${ship.order.address}">ƒê·ªãa ch·ªâ</td>
										<td th:text="${#numbers.formatDecimal(ship.order.amountFromUser,0,'POINT',0,'COMMA')} + ' ‚Ç´'"></td>
										<td class="d-none d-lg-table-cell" th:text="${#temporals.format(ship.updatedAt,'dd/MM/yyyy HH:mm')}">Ng√†y</td>
										<td class="d-none d-xl-table-cell">
											<small th:text="${ship.note != null ? ship.note : 'Kh√¥ng c√≥ ghi ch√∫'}"></small>
										</td>
										<td class="text-end pe-3">
											<a th:href="@{'/shipper/shipment/' + ${ship.id}}"
												class="btn btn-sm btn-outline-secondary">
												<i class="fas fa-eye"></i> <span class="d-none d-sm-inline">Chi ti·∫øt</span>
											</a>
										</td>
									</tr>
									<tr th:if="${#lists.isEmpty(failed.content)}">
										<td colspan="7" class="text-center text-muted py-4">
											<i class="fas fa-inbox fa-2x mb-2"></i><br>
											Kh√¥ng c√≥ ƒë∆°n h√†ng th·∫•t b·∫°i
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>

			<!-- üîΩ Ph√¢n trang -->
			<div class="card-footer bg-light" th:if="${totalPages > 1}">
				<nav>
					<ul class="pagination justify-content-center mb-0">
						<li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
							<a class="page-link" 
							   th:href="@{/shipper/dashboard(page=0, keyword=${keyword}, status=${status}, fromDate=${fromDate}, toDate=${toDate})}"
							   aria-label="First">
								<i class="fas fa-angle-double-left"></i>
							</a>
						</li>
						<li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
							<a class="page-link" 
							   th:href="@{/shipper/dashboard(page=${currentPage - 1}, keyword=${keyword}, status=${status}, fromDate=${fromDate}, toDate=${toDate})}"
							   aria-label="Previous">
								<i class="fas fa-angle-left"></i>
							</a>
						</li>
						<li th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
							class="page-item"
							th:classappend="${i == currentPage} ? 'active'">
							<a class="page-link"
								th:href="@{/shipper/dashboard(page=${i}, keyword=${keyword}, status=${status}, fromDate=${fromDate}, toDate=${toDate})}"
								th:text="${i + 1}"></a>
						</li>
						<li class="page-item" th:classappend="${currentPage == totalPages - 1} ? 'disabled'">
							<a class="page-link" 
							   th:href="@{/shipper/dashboard(page=${currentPage + 1}, keyword=${keyword}, status=${status}, fromDate=${fromDate}, toDate=${toDate})}"
							   aria-label="Next">
								<i class="fas fa-angle-right"></i>
							</a>
						</li>
						<li class="page-item" th:classappend="${currentPage == totalPages - 1} ? 'disabled'">
							<a class="page-link" 
							   th:href="@{/shipper/dashboard(page=${totalPages - 1}, keyword=${keyword}, status=${status}, fromDate=${fromDate}, toDate=${toDate})}"
							   aria-label="Last">
								<i class="fas fa-angle-double-right"></i>
							</a>
						</li>
					</ul>
				</nav>
			</div>
		</div>
	</div>

	<div th:replace="~{fragments/footer-shipper :: footer-shipper}"></div>
</body>
</html>
