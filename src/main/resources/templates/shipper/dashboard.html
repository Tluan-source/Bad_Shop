<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head th:replace="~{fragments/head :: head}">
<title>Shipper Dashboard - Badminton Marketplace</title>
</head>
<body>
	<div th:replace="~{fragments/header-shipper :: header-shipper}"></div>

	<div class="container-fluid mt-4">
		<div class="alert alert-success alert-dismissible fade show"
			role="alert">
			<i class="fas fa-check-circle"></i> Ch√†o m·ª´ng <strong
				sec:authentication="name">Shipper</strong> ƒë·∫øn v·ªõi trang qu·∫£n l√Ω
			giao h√†ng!
			<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
		</div>

		<h2>Dashboard - T·ªïng quan giao h√†ng</h2>

		<!-- üîç T√¨m ki·∫øm v√† l·ªçc -->
		<form class="row mb-4" method="get" th:action="@{/shipper/dashboard}">
			<div class="col-md-3">
				<input type="text" name="keyword" class="form-control"
					placeholder="üîç T√¨m theo t√™n / ƒë·ªãa ch·ªâ" th:value="${keyword}">
			</div>
			<div class="col-md-2">
				<select class="form-select" name="status">
					<option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
					<option value="ACCEPTED" th:selected="${status == 'ACCEPTED'}">Ch·ªù
						nh·∫≠n</option>
					<option value="DELIVERING" th:selected="${status == 'DELIVERING'}">ƒêang
						giao</option>
					<option value="DELIVERED" th:selected="${status == 'DELIVERED'}">ƒê√£
						giao</option>
					<option value="FAILED" th:selected="${status == 'FAILED'}">Th·∫•t
						b·∫°i</option>
				</select>
			</div>
			<div class="col-md-2">
				<input type="date" name="fromDate" class="form-control"
					th:value="${fromDate}">
			</div>
			<div class="col-md-2">
				<input type="date" name="toDate" class="form-control"
					th:value="${toDate}">
			</div>
			<div class="col-md-3">
				<button type="submit" class="btn btn-primary w-100">
					<i class="fas fa-filter"></i> L·ªçc / T√¨m ki·∫øm
				</button>
			</div>
		</form>

		<!-- üì¶ T·ªïng quan -->
		<!-- üì¶ T·ªïng quan -->
		<div class="row mt-3">
			<div class="col-md-3">
				<div class="card text-white bg-warning mb-3 shadow">
					<div class="card-body d-flex justify-content-between">
						<div>
							<h5>Ch·ªù nh·∫≠n</h5>
							<h2
								th:text="${pendingShipments != null ? pendingShipments.totalElements : 0}">0</h2>
						</div>
						<i class="fas fa-box fa-3x"></i>
					</div>
				</div>
			</div>
			<div class="col-md-3">
				<div class="card text-white bg-info mb-3 shadow">
					<div class="card-body d-flex justify-content-between">
						<div>
							<h5>ƒêang giao</h5>
							<h2
								th:text="${delivering != null ? delivering.totalElements : 0}">0</h2>
						</div>
						<i class="fas fa-truck fa-3x"></i>
					</div>
				</div>
			</div>
			<div class="col-md-3">
				<div class="card text-white bg-success mb-3 shadow">
					<div class="card-body d-flex justify-content-between">
						<div>
							<h5>ƒê√£ giao</h5>
							<h2 th:text="${delivered != null ? delivered.totalElements : 0}">0</h2>
						</div>
						<i class="fas fa-check-circle fa-3x"></i>
					</div>
				</div>
			</div>
			<div class="col-md-3">
				<div class="card text-white bg-danger mb-3 shadow">
					<div class="card-body d-flex justify-content-between">
						<div>
							<h5>Th·∫•t b·∫°i</h5>
							<h2 th:text="${failed != null ? failed.totalElements : 0}">0</h2>
						</div>
						<i class="fas fa-times-circle fa-3x"></i>
					</div>
				</div>
			</div>
		</div>

		<!-- üîΩ Ph√¢n trang t·ªïng v·ªõi highlight v√† n√∫t ƒë·∫ßu/cu·ªëi -->
		<nav th:if="${totalPages > 1}" class="mt-3 mb-4">
			<ul class="pagination justify-content-center">
				<!-- N√∫t v·ªÅ trang ƒë·∫ßu -->
				<li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
					<a class="page-link" 
					   th:href="@{/shipper/dashboard(page=0, keyword=${keyword}, status=${status}, fromDate=${fromDate}, toDate=${toDate})}"
					   aria-label="First">
						<i class="fas fa-angle-double-left"></i>
					</a>
				</li>
				
				<!-- N√∫t Previous -->
				<li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
					<a class="page-link" 
					   th:href="@{/shipper/dashboard(page=${currentPage - 1}, keyword=${keyword}, status=${status}, fromDate=${fromDate}, toDate=${toDate})}"
					   aria-label="Previous">
						<i class="fas fa-angle-left"></i>
					</a>
				</li>
				
				<!-- C√°c s·ªë trang -->
				<li th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
					class="page-item"
					th:classappend="${i == currentPage} ? 'active'">
					<a class="page-link"
						th:href="@{/shipper/dashboard(page=${i}, keyword=${keyword}, status=${status}, fromDate=${fromDate}, toDate=${toDate})}"
						th:text="${i + 1}"></a>
				</li>
				
				<!-- N√∫t Next -->
				<li class="page-item" th:classappend="${currentPage == totalPages - 1} ? 'disabled'">
					<a class="page-link" 
					   th:href="@{/shipper/dashboard(page=${currentPage + 1}, keyword=${keyword}, status=${status}, fromDate=${fromDate}, toDate=${toDate})}"
					   aria-label="Next">
						<i class="fas fa-angle-right"></i>
					</a>
				</li>
				
				<!-- N√∫t v·ªÅ trang cu·ªëi -->
				<li class="page-item" th:classappend="${currentPage == totalPages - 1} ? 'disabled'">
					<a class="page-link" 
					   th:href="@{/shipper/dashboard(page=${totalPages - 1}, keyword=${keyword}, status=${status}, fromDate=${fromDate}, toDate=${toDate})}"
					   aria-label="Last">
						<i class="fas fa-angle-double-right"></i>
					</a>
				</li>
			</ul>
		</nav>

		<!-- ‚úÖ N·∫øu showAll = true -> hi·ªán ƒë·∫ßy ƒë·ªß 4 b·∫£ng -->
		<div th:if="${showAll}">

			<!-- üü° ƒê∆°n h√†ng ch·ªù nh·∫≠n -->
			<div class="card mt-4 shadow">
				<div class="card-header bg-warning text-white">
					<h5>
						<i class="fas fa-tasks"></i> ƒê∆°n h√†ng ch·ªù nh·∫≠n
					</h5>
				</div>
				<div class="card-body">
					<table class="table table-hover align-middle">
						<thead>
							<tr>
								<th>M√£ ƒë∆°n</th>
								<th>Kh√°ch h√†ng</th>
								<th>ƒê·ªãa ch·ªâ</th>
								<th>COD</th>
								<th>Ng√†y t·∫°o</th>
								<th>Thao t√°c</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="ship : ${pendingShipments.content}">
								<td th:text="${ship.order.id}">#ORD</td>
								<td th:text="${ship.order.user.fullName}">T√™n</td>
								<td th:text="${ship.order.address}">ƒê·ªãa ch·ªâ</td>
								<td
									th:text="${#numbers.formatDecimal(ship.order.amountFromUser,0,'POINT',0,'COMMA')} + ' ‚Ç´'"></td>
								<td th:text="${#temporals.format(ship.createdAt,'dd/MM/yyyy')}">Ng√†y</td>
								<td><a th:href="@{'/shipper/shipment/' + ${ship.id}}"
									class="btn btn-sm btn-outline-secondary"><i
										class="fas fa-eye"></i></a>
									<form th:action="@{'/shipper/accept/' + ${ship.id}}"
										method="post" class="d-inline">
										<button type="submit" class="btn btn-sm btn-primary">
											<i class="fas fa-handshake"></i> Nh·∫≠n
										</button>
									</form></td>
							</tr>
							<tr th:if="${#lists.isEmpty(pendingShipments.content)}">
								<td colspan="6" class="text-center text-muted">Kh√¥ng c√≥ ƒë∆°n
									ph√π h·ª£p.</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>

			<!-- üîµ ƒê∆°n h√†ng ƒëang giao -->
			<div class="card mt-4 shadow">
				<div class="card-header bg-info text-white">
					<h5>
						<i class="fas fa-truck"></i> ƒê∆°n h√†ng ƒëang giao
					</h5>
				</div>
				<div class="card-body">
					<table class="table table-hover align-middle">
						<thead>
							<tr>
								<th>M√£ ƒë∆°n</th>
								<th>Kh√°ch h√†ng</th>
								<th>ƒê·ªãa ch·ªâ</th>
								<th>COD</th>
								<th>Th·ªùi gian nh·∫≠n</th>
								<th>Thao t√°c</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="ship : ${delivering.content}">
								<td th:text="${ship.order.id}">#ORD</td>
								<td th:text="${ship.order.user.fullName}">T√™n</td>
								<td th:text="${ship.order.address}">ƒê·ªãa ch·ªâ</td>
								<td
									th:text="${#numbers.formatDecimal(ship.order.amountFromUser,0,'POINT',0,'COMMA')} + ' ‚Ç´'"></td>
								<td
									th:text="${#temporals.format(ship.acceptedAt,'HH:mm dd/MM')}">Gi·ªù</td>
								<td><a th:href="@{'/shipper/shipment/' + ${ship.id}}"
									class="btn btn-sm btn-outline-secondary"><i
										class="fas fa-eye"></i></a>
									<form th:action="@{'/shipper/delivered/' + ${ship.id}}"
										method="post" class="d-inline">
										<button type="submit" class="btn btn-sm btn-success">
											<i class="fas fa-check"></i>
										</button>
									</form>
									<form th:action="@{'/shipper/failed/' + ${ship.id}}"
										method="post" class="d-inline">
										<input type="text" name="note" placeholder="Ghi ch√∫ th·∫•t b·∫°i"
											class="form-control form-control-sm d-inline-block w-auto me-1"
											required>
										<button type="submit" class="btn btn-sm btn-danger">
											<i class="fas fa-times"></i>
										</button>
									</form></td>
							</tr>
							<tr th:if="${#lists.isEmpty(delivering.content)}">
								<td colspan="6" class="text-center text-muted">Kh√¥ng c√≥ ƒë∆°n
									ph√π h·ª£p.</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>

			<!-- üü¢ ƒê∆°n h√†ng ƒë√£ giao -->
			<div class="card mt-4 shadow">
				<div class="card-header bg-success text-white">
					<h5>
						<i class="fas fa-check-circle"></i> ƒê∆°n h√†ng giao th√†nh c√¥ng
					</h5>
				</div>
				<div class="card-body">
					<table class="table table-hover align-middle">
						<thead>
							<tr>
								<th>M√£ ƒë∆°n</th>
								<th>Kh√°ch h√†ng</th>
								<th>ƒê·ªãa ch·ªâ</th>
								<th>COD</th>
								<th>Ng√†y giao</th>
								<th>Xem</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="ship : ${delivered.content}">
								<td th:text="${ship.order.id}">#ORD</td>
								<td th:text="${ship.order.user.fullName}">T√™n</td>
								<td th:text="${ship.order.address}">ƒê·ªãa ch·ªâ</td>
								<td
									th:text="${#numbers.formatDecimal(ship.order.amountFromUser,0,'POINT',0,'COMMA')} + ' ‚Ç´'"></td>
								<td
									th:text="${#temporals.format(ship.deliveredAt,'dd/MM/yyyy HH:mm')}">Ng√†y</td>
								<td><a th:href="@{'/shipper/shipment/' + ${ship.id}}"
									class="btn btn-sm btn-outline-secondary"><i
										class="fas fa-eye"></i></a></td>
							</tr>
							<tr th:if="${#lists.isEmpty(delivered.content)}">
								<td colspan="6" class="text-center text-muted">Kh√¥ng c√≥ ƒë∆°n
									ph√π h·ª£p.</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>

			<!-- üî¥ ƒê∆°n h√†ng th·∫•t b·∫°i -->
			<div class="card mt-4 shadow mb-5">
				<div class="card-header bg-danger text-white">
					<h5>
						<i class="fas fa-times-circle"></i> ƒê∆°n h√†ng giao th·∫•t b·∫°i
					</h5>
				</div>
				<div class="card-body">
					<table class="table table-hover align-middle">
						<thead>
							<tr>
								<th>M√£ ƒë∆°n</th>
								<th>Kh√°ch h√†ng</th>
								<th>ƒê·ªãa ch·ªâ</th>
								<th>COD</th>
								<th>Ng√†y c·∫≠p nh·∫≠t</th>
								<th>Ghi ch√∫</th>
								<th>Xem</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="ship : ${failed.content}">
								<td th:text="${ship.order.id}">#ORD</td>
								<td th:text="${ship.order.user.fullName}">T√™n</td>
								<td th:text="${ship.order.address}">ƒê·ªãa ch·ªâ</td>
								<td
									th:text="${#numbers.formatDecimal(ship.order.amountFromUser,0,'POINT',0,'COMMA')} + ' ‚Ç´'"></td>
								<td
									th:text="${#temporals.format(ship.updatedAt,'dd/MM/yyyy HH:mm')}">Ng√†y</td>
								<td
									th:text="${ship.note != null ? ship.note : 'Kh√¥ng c√≥ ghi ch√∫'}"></td>
								<td><a th:href="@{'/shipper/shipment/' + ${ship.id}}"
									class="btn btn-sm btn-outline-secondary"><i
										class="fas fa-eye"></i></a></td>
							</tr>
							<tr th:if="${#lists.isEmpty(failed.content)}">
								<td colspan="7" class="text-center text-muted">Kh√¥ng c√≥ ƒë∆°n
									ph√π h·ª£p.</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>

		</div>

		<!-- ‚úÖ N·∫øu showAll = false -> hi·ªÉn th·ªã ch·ªâ 1 b·∫£ng l·ªçc -->
		<div th:if="${!showAll}">
			<div class="card mt-4 shadow">
				<div class="card-header bg-primary text-white">
					<h5>
						<i class="fas fa-list"></i> K·∫øt qu·∫£ l·ªçc ƒë∆°n h√†ng
					</h5>
				</div>
				<div class="card-body">
					<table class="table table-hover align-middle">
						<thead>
							<tr>
								<th>M√£ ƒë∆°n</th>
								<th>Kh√°ch h√†ng</th>
								<th>ƒê·ªãa ch·ªâ</th>
								<th>COD</th>
								<th>Ng√†y</th>
								<th>Tr·∫°ng th√°i</th>
								<th>Thao t√°c</th>
							</tr>
						</thead>
						<tbody>
							<tr
								th:each="ship : ${pendingShipments.content != null && !#lists.isEmpty(pendingShipments.content) ? pendingShipments.content :
												 delivering.content != null && !#lists.isEmpty(delivering.content) ? delivering.content :
												 delivered.content != null && !#lists.isEmpty(delivered.content) ? delivered.content :
												 failed.content != null && !#lists.isEmpty(failed.content) ? failed.content : {}}">
								<td th:text="${ship.order.id}"></td>
								<td th:text="${ship.order.user.fullName}"></td>
								<td th:text="${ship.order.address}"></td>
								<td
									th:text="${#numbers.formatDecimal(ship.order.amountFromUser,0,'POINT',0,'COMMA')} + ' ‚Ç´'"></td>
								<td
									th:text="${#temporals.format(ship.createdAt,'dd/MM/yyyy HH:mm')}"></td>
								<td><span class="badge bg-secondary"
									th:text="${ship.status}"></span></td>
								<td><a th:href="@{'/shipper/shipment/' + ${ship.id}}"
									class="btn btn-sm btn-outline-secondary ms-2"> <i
										class="fas fa-eye"></i>
								</a></td>
							</tr>
							<tr
								th:if="${#lists.isEmpty(pendingShipments.content) and #lists.isEmpty(delivering.content) and #lists.isEmpty(delivered.content) and #lists.isEmpty(failed.content)}">
								<td colspan="7" class="text-center text-muted">Kh√¥ng c√≥ ƒë∆°n
									ph√π h·ª£p.</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>

	<div th:replace="~{fragments/footer-shipper :: footer-shipper}"></div>
</body>
</html>
