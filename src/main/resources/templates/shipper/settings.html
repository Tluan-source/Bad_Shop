<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{fragments/head :: head}">
<title>Cài đặt - Shipper</title>
</head>
<body>
	<div th:replace="~{fragments/header-shipper :: header-shipper}"></div>

	<div class="container mt-4">
		<h2><i class="fas fa-cog"></i> Cài đặt tài khoản</h2>
		<p class="text-muted">Quản lý cài đặt và bảo mật tài khoản của bạn</p>

		<!-- Thông báo -->
		<div th:if="${message}" class="alert alert-success alert-dismissible fade show" role="alert">
			<i class="fas fa-check-circle"></i> <span th:text="${message}">Thành công</span>
			<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
		</div>
		
		<div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
			<i class="fas fa-exclamation-circle"></i> <span th:text="${error}">Lỗi</span>
			<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
		</div>

		<div class="row">
			<div class="col-md-3">
				<!-- Thông tin tài khoản -->
				<div class="card shadow-sm mb-3">
					<div class="card-body text-center">
						<div class="mb-3">
							<i class="fas fa-user-circle fa-4x text-info"></i>
						</div>
						<h6 class="mb-1" th:text="${user.fullName}">Tên shipper</h6>
						<p class="text-muted small mb-2" th:text="${user.email}">email@example.com</p>
						<span class="badge bg-info">
							<i class="fas fa-shipping-fast"></i> Shipper
						</span>
					</div>
				</div>

				<div class="card shadow-sm">
					<div class="card-body">
						<h6 class="mb-3"><i class="fas fa-shield-alt"></i> Bảo mật</h6>
						<div class="mb-2">
							<small class="text-muted">Mã nhân viên:</small>
							<div><strong th:text="${user.id}">U100</strong></div>
						</div>
						<div class="mb-2">
							<small class="text-muted">Trạng thái:</small>
							<div>
								<span class="badge bg-success">
									<i class="fas fa-check-circle"></i> Hoạt động
								</span>
							</div>
						</div>
						<div class="mb-2">
							<small class="text-muted">Ngày tham gia:</small>
							<div th:text="${#temporals.format(user.createdAt, 'dd/MM/yyyy')}">27/10/2025</div>
						</div>
					</div>
				</div>
			</div>

			<div class="col-md-9">
				<!-- Đổi mật khẩu -->
				<div class="card shadow-sm">
					<div class="card-header bg-primary text-white">
						<h5 class="mb-0"><i class="fas fa-key"></i> Đổi mật khẩu</h5>
					</div>
					<div class="card-body">
						<form method="post" th:action="@{/shipper/settings/change-password}" id="changePasswordForm">
							<div class="alert alert-info">
								<i class="fas fa-info-circle"></i> 
								Mật khẩu mới phải có ít nhất 6 ký tự.
							</div>

							<div class="mb-3">
								<label class="form-label">Mật khẩu hiện tại <span class="text-danger">*</span></label>
								<div class="input-group">
									<input type="password" class="form-control" name="currentPassword" 
										   id="currentPassword" required minlength="6">
									<button class="btn btn-outline-secondary" type="button" onclick="togglePassword('currentPassword')">
										<i class="fas fa-eye"></i>
									</button>
								</div>
							</div>

							<div class="mb-3">
								<label class="form-label">Mật khẩu mới <span class="text-danger">*</span></label>
								<div class="input-group">
									<input type="password" class="form-control" name="newPassword" 
										   id="newPassword" required minlength="6">
									<button class="btn btn-outline-secondary" type="button" onclick="togglePassword('newPassword')">
										<i class="fas fa-eye"></i>
									</button>
								</div>
								<div class="form-text">
									<i class="fas fa-info-circle"></i> Tối thiểu 6 ký tự
								</div>
							</div>

							<div class="mb-3">
								<label class="form-label">Xác nhận mật khẩu mới <span class="text-danger">*</span></label>
								<div class="input-group">
									<input type="password" class="form-control" name="confirmPassword" 
										   id="confirmPassword" required minlength="6">
									<button class="btn btn-outline-secondary" type="button" onclick="togglePassword('confirmPassword')">
										<i class="fas fa-eye"></i>
									</button>
								</div>
							</div>

							<button type="submit" class="btn btn-primary">
								<i class="fas fa-check"></i> Đổi mật khẩu
							</button>
							<a th:href="@{/shipper/dashboard}" class="btn btn-secondary">
								<i class="fas fa-arrow-left"></i> Quay lại
							</a>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script>
		// Toggle hiển thị mật khẩu
		function togglePassword(fieldId) {
			const field = document.getElementById(fieldId);
			const icon = event.currentTarget.querySelector('i');
			
			if (field.type === 'password') {
				field.type = 'text';
				icon.classList.remove('fa-eye');
				icon.classList.add('fa-eye-slash');
			} else {
				field.type = 'password';
				icon.classList.remove('fa-eye-slash');
				icon.classList.add('fa-eye');
			}
		}

		// Kiểm tra mật khẩu xác nhận
		document.getElementById('confirmPassword').addEventListener('input', function() {
			const newPass = document.getElementById('newPassword').value;
			const confirmPass = this.value;
			
			if (newPass !== confirmPass) {
				this.setCustomValidity('Mật khẩu xác nhận không khớp');
			} else {
				this.setCustomValidity('');
			}
		});
	</script>
</body>
</html>