<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head th:replace="~{fragments/head :: head}">
    <title>Store Info - Badminton Marketplace</title>
</head>
<body>
    <div th:replace="~{fragments/header :: header}"></div>

    <div class="container-fluid mt-4">
        <div class="row">
            <!-- Sidebar -->
            <div th:replace="~{vendor/fragments/sidebar :: sidebar('store')}"></div>

            <!-- Main content -->
            <div class="col-md-10">
                <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
                    <i class="fas fa-check-circle"></i> <span th:text="${success}"></span>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>

                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2><i class="fas fa-store-alt"></i> Thông tin cửa hàng</h2>
                    <a th:href="@{/vendor/store/edit}" class="btn btn-primary">
                        <i class="fas fa-edit"></i> Chỉnh sửa
                    </a>
                </div>

                <!-- Store Information Card -->
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="fas fa-info-circle"></i> Chi tiết cửa hàng</h5>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="info-item">
                                    <label class="text-muted small"><i class="fas fa-id-card"></i> Mã cửa hàng</label>
                                    <p class="fw-bold" th:text="${store.id}">ST001</p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="info-item">
                                    <label class="text-muted small"><i class="fas fa-toggle-on"></i> Trạng thái</label>
                                    <p>
                                        <span th:if="${store.isActive}" class="badge bg-success fs-6">
                                            <i class="fas fa-check-circle"></i> Đang hoạt động
                                        </span>
                                        <span th:unless="${store.isActive}" class="badge bg-danger fs-6">
                                            <i class="fas fa-ban"></i> Tạm ngừng
                                        </span>
                                    </p>
                                </div>
                            </div>
                        </div>

                        <hr>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="info-item">
                                    <label class="text-muted small"><i class="fas fa-store"></i> Tên cửa hàng</label>
                                    <p class="fw-bold" th:text="${store.name}">Store Name</p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="info-item">
                                    <label class="text-muted small"><i class="fas fa-phone"></i> Số điện thoại cửa hàng </label>
                                    <p th:text="${store.phone != null ? store.phone : 'Chưa cập nhật'}">Phone</p>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="info-item">
                                    <label class="text-muted small"><i class="fas fa-user"></i> Tên chủ shop</label>
                                    <p th:text="${store.ownerName}">Owner Name</p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="info-item">
                                    <label class="text-muted small"><i class="fas fa-envelope"></i> Email cửa hàng</label>
                                    <p th:text="${store.email != null ? store.email : ('Chưa cập nhật')}">email@example.com</p>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-12">
                                <div class="info-item">
                                    <label class="text-muted small"><i class="fas fa-align-left"></i> Mô tả cửa hàng (Bio)</label>
                                    <div class="p-3 bg-light rounded">
                                        <p class="mb-0" th:text="${store.bio != null ? store.bio : 'Chưa có mô tả'}">Bio</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Store images gallery -->
                        <div class="row mb-3">
                            <div class="col-md-12">
                                <div class="info-item">
                                    <label class="text-muted small"><i class="fas fa-image"></i> Ảnh cửa hàng</label>
                                    <input type="hidden" id="storeFeaturedImagesJson" th:value="${store.featuredImages}" />
                                    <div id="storeImagesGallery" class="d-flex flex-wrap gap-2 mt-2"></div>
                                </div>
                            </div>
                        </div>

                       

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="info-item">
                                    <label class="text-muted small"><i class="fas fa-percent"></i> Chiết khấu</label>
                                    <p th:if="${store.commissionName != null}">
                                        <span th:text="${store.commissionName}">Commission</span>
                                        <span class="text-muted">
                                            (<span th:text="${store.commissionFeePercent}">0</span>%)
                                        </span>
                                    </p>
                                    <p th:unless="${store.commissionName != null}" class="text-muted">Chưa có</p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="info-item">
                                    <label class="text-muted small"><i class="fas fa-calendar-plus"></i> Ngày tham gia</label>
                                    <p th:text="${#temporals.format(store.createdAt, 'dd/MM/yyyy HH:mm')}">01/01/2024</p>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="info-item">
                                    <label class="text-muted small"><i class="fas fa-star"></i> Đánh giá trung bình</label>
                                    <p>
                                        <i class="fas fa-star text-warning"></i>
                                        <span th:text="${store.rating != null ? #numbers.formatDecimal(store.rating, 1, 'POINT', 1, 'POINT') : '0.0'}">0.0</span>
                                        <span class="text-muted">/ 5.0</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div th:replace="~{fragments/footer :: footer}"></div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const input = document.getElementById('storeFeaturedImagesJson');
            const gallery = document.getElementById('storeImagesGallery');
            if (!gallery) return;
            gallery.innerHTML = '';
            if (!input) {
                gallery.innerHTML = '<small class="text-muted">Chưa có ảnh</small>';
                return;
            }
            const val = input.value;
            if (!val || val.trim() === '') {
                gallery.innerHTML = '<small class="text-muted">Chưa có ảnh</small>';
                return;
            }
            try {
                const arr = JSON.parse(val);
                if (!Array.isArray(arr) || arr.length === 0) {
                    gallery.innerHTML = '<small class="text-muted">Chưa có ảnh</small>';
                    return;
                }
                arr.forEach(url => {
                    const wrapper = document.createElement('div');
                    wrapper.style.width = '120px';
                    wrapper.style.height = '120px';
                    wrapper.style.overflow = 'hidden';

                    const img = document.createElement('img');
                    img.src = url;
                    img.alt = 'Ảnh cửa hàng';
                    img.className = 'img-thumbnail';
                    img.style.width = '100%';
                    img.style.height = '100%';
                    img.style.objectFit = 'cover';

                    wrapper.appendChild(img);
                    gallery.appendChild(wrapper);
                });
            } catch (e) {
                gallery.innerHTML = '<small class="text-muted">Chưa có ảnh</small>';
            }
        });
    </script>
    
    <style>
        .info-item {
            margin-bottom: 1rem;
        }
        .info-item label {
            display: block;
            margin-bottom: 0.25rem;
            font-weight: 600;
        }
        .info-item p {
            margin-bottom: 0;
            font-size: 1rem;
        }
    </style>
</body>
</html>
