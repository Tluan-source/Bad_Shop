<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
     <head>
          <meta charset="UTF-8" />
          <title>Thanh toán bằng QR Ngân hàng</title>
          <link
               href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
               rel="stylesheet"
          />
     </head>
     <body class="bg-light">
          <div class="container text-center mt-5">
               <div class="card shadow p-4">
                    <h3 class="mb-3">Thanh toán bằng QR ngân hàng</h3>
                    <p>Quét mã QR bằng ứng dụng ngân hàng / Momo / ZaloPay</p>

                    <div id="qrBox" class="my-3"></div>

                    <p class="fw-bold">
                         Số tiền:
                         <span
                              th:text="${#numbers.formatDecimal(amount, 0, 'COMMA', 0, 'POINT')}"
                         ></span>
                         VNĐ
                    </p>

                    <p class="text-muted">
                         Nội dung chuyển khoản:<br />
                         <b th:text="${description}"></b>
                    </p>

                    <button class="btn btn-success mt-3" onclick="confirmPaid()">
                         ✅ Tôi đã chuyển khoản
                    </button>

                    <a href="/orders" class="btn btn-secondary mt-2">Quay lại đơn hàng</a>
               </div>
          </div>

          <script>
               const orderId = "[[${orderId}]]";
               const bankCode = "[[${bankCode}]]";
               const account = "[[${bankAccount}]]";
               const name = "[[${accountName}]]";
               const amount = "[[${amount}]]";
               const description = "[[${description}]]";

               // Gọi API VietQR.dev tạo ảnh QR
               const qrUrl = `https://img.vietqr.io/image/${bankCode}-${account}-compact.png?amount=${amount}&addInfo=${description}&accountName=${name}`;

               document.getElementById("qrBox").innerHTML = `<img src="${qrUrl}" width="260"/>`;

               function confirmPaid() {
                    alert("Cảm ơn bạn! Hệ thống sẽ kiểm tra giao dịch.");
                    window.location.href = "/orders";
               }
          </script>
     </body>
</html>
